<!doctype html>
<html lang="en">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>nullclaw Web UI Demo</title>
  <style>
    :root {
      color-scheme: light;
      --bg: #f4f6f8;
      --panel: #ffffff;
      --text: #1d2430;
      --muted: #5a6577;
      --accent: #1f6feb;
      --accent-2: #0f4fb6;
      --border: #d6dbe3;
    }
    * { box-sizing: border-box; }
    body {
      margin: 0;
      font: 14px/1.45 ui-sans-serif, system-ui, -apple-system, Segoe UI, Roboto, Helvetica, Arial;
      background: radial-gradient(circle at top right, #e7eefb 0%, var(--bg) 45%);
      color: var(--text);
      min-height: 100vh;
      padding: 20px;
    }
    .layout {
      max-width: 980px;
      margin: 0 auto;
      display: grid;
      gap: 16px;
      grid-template-columns: 320px 1fr;
    }
    .card {
      background: var(--panel);
      border: 1px solid var(--border);
      border-radius: 12px;
      box-shadow: 0 6px 16px rgba(20, 31, 57, 0.08);
      padding: 14px;
    }
    .card h2 { margin: 0 0 10px; font-size: 16px; }
    label { display: block; margin: 0 0 8px; color: var(--muted); font-size: 12px; }
    input, textarea, button {
      width: 100%;
      border: 1px solid var(--border);
      border-radius: 8px;
      padding: 8px 10px;
      font: inherit;
      background: #fff;
      color: var(--text);
    }
    textarea { min-height: 64px; resize: vertical; }
    .row { display: flex; gap: 8px; }
    .row > * { flex: 1; }
    button {
      cursor: pointer;
      background: var(--accent);
      color: #fff;
      border-color: var(--accent);
      font-weight: 600;
    }
    button:hover { background: var(--accent-2); }
    button.secondary {
      background: #fff;
      color: var(--text);
      border-color: var(--border);
    }
    .status { font-size: 12px; color: var(--muted); margin-top: 6px; }
    .messages {
      height: 460px;
      overflow: auto;
      background: #fbfcff;
      border: 1px solid var(--border);
      border-radius: 10px;
      padding: 10px;
      display: flex;
      flex-direction: column;
      gap: 8px;
    }
    .msg {
      padding: 8px 10px;
      border-radius: 10px;
      max-width: 88%;
      white-space: pre-wrap;
      word-break: break-word;
    }
    .msg.user {
      margin-left: auto;
      background: #dce8ff;
      border: 1px solid #bfd5ff;
    }
    .msg.assistant {
      margin-right: auto;
      background: #eef2f7;
      border: 1px solid #dbe2ea;
    }
    @media (max-width: 860px) {
      .layout { grid-template-columns: 1fr; }
      .messages { height: 360px; }
    }
  </style>
</head>
<body>
  <div class="layout">
    <section class="card">
      <h2>Relay Connection</h2>
      <label>WebSocket URL
        <input id="url" value="ws://127.0.0.1:32123/ws" />
      </label>
      <label>Auth token
        <input id="token" placeholder="channels.web.accounts.<id>.auth_token" />
      </label>
      <label>Session ID
        <input id="session" value="default" />
      </label>
      <label>Sender ID
        <input id="sender" value="web-user" />
      </label>
      <div class="row">
        <button id="connect">Connect</button>
        <button id="disconnect" class="secondary">Disconnect</button>
      </div>
      <div id="status" class="status">Disconnected</div>
    </section>

    <section class="card">
      <h2>Chat</h2>
      <div id="messages" class="messages"></div>
      <label style="margin-top:10px;">Message
        <textarea id="input" placeholder="Type message and press Send"></textarea>
      </label>
      <div class="row">
        <button id="send">Send</button>
        <button id="clear" class="secondary">Clear</button>
      </div>
    </section>
  </div>

  <script>
    let ws = null;

    const el = {
      url: document.getElementById("url"),
      token: document.getElementById("token"),
      session: document.getElementById("session"),
      sender: document.getElementById("sender"),
      connect: document.getElementById("connect"),
      disconnect: document.getElementById("disconnect"),
      send: document.getElementById("send"),
      clear: document.getElementById("clear"),
      input: document.getElementById("input"),
      status: document.getElementById("status"),
      messages: document.getElementById("messages"),
    };

    function appendMessage(role, text) {
      const node = document.createElement("div");
      node.className = `msg ${role}`;
      node.textContent = text;
      el.messages.appendChild(node);
      el.messages.scrollTop = el.messages.scrollHeight;
    }

    function setStatus(text) {
      el.status.textContent = text;
    }

    function connect() {
      if (ws && ws.readyState <= 1) return;

      const baseUrl = el.url.value.trim();
      const token = encodeURIComponent(el.token.value.trim());
      const session = encodeURIComponent(el.session.value.trim() || "default");

      if (!baseUrl) {
        setStatus("Missing URL");
        return;
      }
      if (!token) {
        setStatus("Missing auth token");
        return;
      }

      const sep = baseUrl.includes("?") ? "&" : "?";
      const fullUrl = `${baseUrl}${sep}token=${token}&session_id=${session}`;

      ws = new WebSocket(fullUrl);

      ws.onopen = () => setStatus("Connected");
      ws.onclose = () => setStatus("Disconnected");
      ws.onerror = () => setStatus("Connection error");
      ws.onmessage = (event) => {
        try {
          const data = JSON.parse(event.data);
          if (data.type === "assistant_message" && data.content) {
            appendMessage("assistant", data.content);
          }
        } catch {
          appendMessage("assistant", event.data);
        }
      };
    }

    function disconnect() {
      if (ws) {
        ws.close();
        ws = null;
      }
      setStatus("Disconnected");
    }

    function sendMessage() {
      const content = el.input.value.trim();
      if (!content) return;
      if (!ws || ws.readyState !== WebSocket.OPEN) {
        setStatus("Not connected");
        return;
      }

      const payload = {
        type: "user_message",
        content,
        session_id: el.session.value.trim() || "default",
        sender_id: el.sender.value.trim() || "web-user",
      };

      ws.send(JSON.stringify(payload));
      appendMessage("user", content);
      el.input.value = "";
      el.input.focus();
    }

    el.connect.addEventListener("click", connect);
    el.disconnect.addEventListener("click", disconnect);
    el.send.addEventListener("click", sendMessage);
    el.clear.addEventListener("click", () => (el.messages.textContent = ""));
    el.input.addEventListener("keydown", (e) => {
      if (e.key === "Enter" && (e.ctrlKey || e.metaKey)) sendMessage();
    });
  </script>
</body>
</html>
